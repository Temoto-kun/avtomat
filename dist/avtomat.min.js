(function(e){e.Avtomat=e.Avtomat||{StateMachine:function(e,t){function a(e,t,r){n[e].transitions[t]=r}function f(e,t){n[idFrom].transitions[t]=undefined}function l(e,t,i){if(n[e]===undefined){if(o==r)m(e);n[e]=h();if(e!=r){p(e,t);if(i!==undefined)for(var s in i)a(e,s,i[s])}}}function c(e){n[e]=undefined}function h(){return{"final":false,transitions:[],events:{arriving:[],arrive:[],leaving:[],leave:[]}}}function p(e,t){if(e!=r)n[e].final=t}function d(){s=[o];v("");return s}function v(e){var t=s,o=[],a=false,f;f=u.changing;for(var l in f)f[l]();while(t.length>0){var c=t.shift();f=n[c].events.leaving;for(l in f)f[l]();var h=n[c].transitions[e]||(e==i?c:r);var p;if(h instanceof Array)p=h;else p=[h];for(var d=0;d<p.length;d++){var m=false;for(var g=0,y=o.length;g<y;g++)m=m||o[g]==p[d];if(!m&&p[d]!=r){f=n[c].events.leave;for(l in f)f[l]();f=n[p[d]].events.arriving;for(l in f)f[l]();o.push(p[d]);f=n[p[d]].events.arrive;for(l in f)f[l]()}}if(e==i&&h==r)a=false}s=o;f=u.change;for(l in f)f[l]();if(o.length>0){for(var b in o){if(n[o[b]].transitions[i]!==undefined){a=true;break}}if(a)v(i)}return s}function m(e){o=e}function g(){return s}function y(){for(var e in s)if(n[s[e]]["final"])return true;return false}function b(e,t,r){n[e].events[t].push(r)}function w(e,t){u[e].push(t)}function E(e,t){return n[e].transitions[t]!==undefined||t==i}function S(e){for(var t in n[e].transitions)return true;return false}var n=[],r=null,i="",s=[r],o=t||r,u={changing:[],change:[]};(function(e,t){l(r,false,[]);if(e!==undefined)for(var n in e)l(n,e[n]["final"],e[n].transitions);if(t!==undefined)m(t);d()})(e,t);return{reset:d,input:v,state:g,accepted:y,nullState:function(){return g().length==0},addState:l,deleteState:c,addTransition:a,deleteTransition:f,hasTransition:E,hasTransitions:function(e){if(e==undefined)e=g();else if(e instanceof Array){var t=false;for(var n in e)t=t||S[n];return t}return typeof e=="string"&&S(e)},bindStateEvent:b,bindMachineEvent:w}}}})(window)